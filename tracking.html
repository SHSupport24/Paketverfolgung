<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Sendung verfolgen</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <h3>Tracking eingeben</h3>
  <label>Trackingnummer:
    <input type="text" id="trackingNumber" />
  </label><br />
  <label>Dienst (carrier):
    <select id="carrier">
      <option value="dhl">DHL</option>
      <option value="dhl-de">DHL Express</option>
      <option value="dpd">DPD</option>
      <option value="gls">GLS</option>
      <option value="ups">UPS</option>
    </select>
  </label><br /><br />
  <button onclick="track()">Verfolgen</button>

  <script>
    const t = TrelloPowerUp.iframe();

    async function track() {
      const carrier = document.getElementById('carrier').value;
      const trackingNumber = document.getElementById('trackingNumber').value;

      const res = await fetch(`https://paketverfolgung-wo88.vercel.app/api/tracking?carrier_code=${carrier}&tracking_number=${trackingNumber}`);
      const data = await res.json();

      let status = 'Ausstehend';
      if (data.status === 'delivered') status = 'Zugestellt';
      else if (data.status === 'transit') status = 'Unterwegs';

      await t.set('card', 'shared', 'trackingStatus', status);
      t.closePopup();
    }
  </script>
</body>
</html>
